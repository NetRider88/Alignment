{% extends 'base.html' %}

{% block title %}Logistics Details{% endblock %}

{% block content %}
    <div class="container mt-5">
        <h1>Logistics Details</h1>
        <form method="POST" id="logistics-form">
            {{ form.hidden_tag() }} <!-- Include CSRF token -->
            
            <div id="logistics-events-container">
                {% for event_form in form.events %}
                <div class="event-block border rounded p-3 mt-3">
                    {{ event_form.hidden_tag() }} <!-- Include CSRF token for each event_form -->
                    <div class="form-group">
                        <label>{{ event_form.webinar_url.label }}</label>
                        {{ event_form.webinar_url(class="form-control") }}
                    </div>
                    <div class="form-group">
                        <label>{{ event_form.date_time.label }}</label>
                        {{ event_form.date_time(class="form-control") }}
                    </div>
                    <div class="form-group">
                        <label>{{ event_form.notes.label }}</label>
                        {{ event_form.notes(class="form-control", rows=3) }}
                    </div>
                </div>
                {% endfor %}
            </div>

            <button type="button" class="btn btn-secondary mt-4" id="add-event" onclick="addEvent()">Add Another Event</button>
            <button type="submit" class="btn btn-primary mt-4">{{ form.submit.label }}</button>
        </form>
    </div>

    <script>
        let eventIndex = "{{ form.events|length }}";
        eventIndex = parseInt(eventIndex);

        function addEvent() {
            let container = document.getElementById('logistics-events-container');
            let newEvent = document.createElement('div');
            newEvent.className = 'event-block border rounded p-3 mt-3';
            newEvent.innerHTML = `
                <div class="form-group">
                    <label>Webinar URL</label>
                    <input type="text" class="form-control" name="events-${eventIndex}-webinar_url" id="events-${eventIndex}-webinar_url">
                </div>
                <div class="form-group">
                    <label>Date and Time</label>
                    <input type="datetime-local" class="form-control" name="events-${eventIndex}-date_time" id="events-${eventIndex}-date_time">
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea class="form-control" name="events-${eventIndex}-notes" id="events-${eventIndex}-notes" rows="3"></textarea>
                </div>
            `;
            container.appendChild(newEvent);
            eventIndex++;
        }
    </script>
{% endblock %}
